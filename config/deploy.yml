service: compritas

image: joselo/compritas

servers:
  web:
    hosts:
      - <%= ENV['KAMAL_WEB_IP'] %>

proxy:
  ssl: false
  app_port: 4000
  hosts:
    - <%= ENV['PHX_HOST'] %>

registry:
  server: ghcr.io
  username: joselo

  password:
    - KAMAL_REGISTRY_PASSWORD

builder:
  arch: amd64

env:
  clear:
    PHX_SERVER: true
    STORAGE_PATH: /app/storage
  secret:
    - SECRET_KEY_BASE
    - DATABASE_URL
    - PHX_HOST
    - FROM_EMAIL
    - SMTP_SERVER
    - SMTP_PORT
    - SMTP_USERNAME
    - SMTP_PASSWORD

aliases:
  migrate: app exec --reuse "/app/bin/migrate"
  logs: app logs -f

ssh:
  user: deploy

volumes:
  - storage:/app/storage

